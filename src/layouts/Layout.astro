---
interface Props {
  title: string;
  description?: string;
}

const {
  title,
  description = "Full Stack Developer | Angular, NestJS, TypeScript, Flutter",
} = Astro.props;
---

<!doctype html>
<html lang="es" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <meta name="description" content={description} />

    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />

    <title>{title}</title>
  </head>
  <body
    class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 antialiased transition-colors duration-300"
  >
    <!-- Scroll Progress Indicator -->
    <div
      id="scroll-progress"
      class="fixed top-0 left-0 h-1 bg-teal-900 dark:bg-teal-400 z-100 transition-all duration-300"
      style="width: 0%"
    >
    </div>

    <!-- Back to Top Button -->
    <button
      id="back-to-top"
      class="fixed bottom-6 right-4 md:bottom-8 md:right-8 p-3 md:p-4 bg-teal-900 dark:bg-teal-600 text-white rounded-full shadow-lg hover:bg-teal-800 dark:hover:bg-teal-500 transition-all duration-300 opacity-0 pointer-events-none hover:scale-110 z-50 active:scale-95"
      aria-label="Volver arriba"
    >
      <svg
        class="w-5 h-5 md:w-6 md:h-6"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
      </svg>
    </button>

    <slot />

    <script is:inline>
      // Initialize theme before page renders to prevent flash
      (function () {
        const savedTheme = localStorage.getItem("theme");
        const prefersDark = window.matchMedia(
          "(prefers-color-scheme: dark)",
        ).matches;

        if (savedTheme === "dark" || (!savedTheme && prefersDark)) {
          document.documentElement.classList.add("dark");
        }
      })();

      // Scroll Progress Indicator
      function updateScrollProgress() {
        const winScroll =
          document.body.scrollTop || document.documentElement.scrollTop;
        const height =
          document.documentElement.scrollHeight -
          document.documentElement.clientHeight;
        const scrolled = (winScroll / height) * 100;
        const progressBar = document.getElementById("scroll-progress");
        if (progressBar) {
          progressBar.style.width = scrolled + "%";
        }
      }

      // Back to Top Button
      function toggleBackToTop() {
        const backToTop = document.getElementById("back-to-top");
        if (backToTop) {
          if (window.scrollY > 500) {
            backToTop.classList.remove("opacity-0", "pointer-events-none");
            backToTop.classList.add("opacity-100");
          } else {
            backToTop.classList.add("opacity-0", "pointer-events-none");
            backToTop.classList.remove("opacity-100");
          }
        }
      }

      // Scroll Reveal Animation
      function revealOnScroll() {
        const reveals = document.querySelectorAll("[data-reveal]");
        reveals.forEach((element) => {
          const windowHeight = window.innerHeight;
          const elementTop = element.getBoundingClientRect().top;
          const elementVisible = 150;

          if (elementTop < windowHeight - elementVisible) {
            element.classList.add("active");
          }
        });
      }

      // Initialize on load
      document.addEventListener("DOMContentLoaded", () => {
        // Set up scroll listeners
        window.addEventListener("scroll", () => {
          updateScrollProgress();
          toggleBackToTop();
          revealOnScroll();
        });

        // Back to top click handler
        const backToTop = document.getElementById("back-to-top");
        if (backToTop) {
          backToTop.addEventListener("click", () => {
            window.scrollTo({
              top: 0,
              behavior: "smooth",
            });
          });
        }

        // Initial reveal check
        revealOnScroll();
        updateScrollProgress();
      });

      // Smooth scroll for anchor links
      document.addEventListener("click", (e) => {
        const target = e.target.closest('a[href^="#"]');
        if (target) {
          e.preventDefault();
          const id = target.getAttribute("href");
          const element = document.querySelector(id);
          if (element) {
            const offsetTop = element.offsetTop - 80;
            window.scrollTo({
              top: offsetTop,
              behavior: "smooth",
            });
          }
        }
      });
    </script>
  </body>
</html>
