---
import { getTranslations, type Language } from "../i18n/translations";

interface Props {
  lang?: Language;
}

const { lang = "en" } = Astro.props;
const t = getTranslations(lang);
---

<div class="max-w-2xl mx-auto mb-12">
  <form
    action="https://api.web3forms.com/submit"
    method="POST"
    id="contact-form"
    class="space-y-6"
  >
    <input
      type="hidden"
      name="access_key"
      value="004aa58f-7413-4d79-8982-fe76e3c617c8"
    />
    <input
      type="hidden"
      name="subject"
      value="Nuevo mensaje desde Portfolio - Sergio Barreras"
    />
    <input type="hidden" name="from_name" value="Portfolio Contact Form" />
    <input
      type="checkbox"
      name="botcheck"
      class="hidden"
      style="display: none;"
    />

    <!-- Name -->
    <div>
      <label
        for="name"
        class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
        data-i18n="contact.form.name"
      >
        {t.contact.form.name}
      </label>
      <input
        type="text"
        id="name"
        name="name"
        required
        class="w-full px-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white placeholder-slate-400 dark:placeholder-slate-500 focus:ring-2 focus:ring-teal-900 dark:focus:ring-teal-600 focus:border-transparent transition-all"
        data-i18n-placeholder="contact.form.namePlaceholder"
        placeholder={t.contact.form.namePlaceholder}
      />
    </div>

    <!-- Email -->
    <div>
      <label
        for="email"
        class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
        data-i18n="contact.form.email"
      >
        {t.contact.form.email}
      </label>
      <input
        type="email"
        id="email"
        name="email"
        required
        class="w-full px-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white placeholder-slate-400 dark:placeholder-slate-500 focus:ring-2 focus:ring-teal-900 dark:focus:ring-teal-600 focus:border-transparent transition-all"
        data-i18n-placeholder="contact.form.emailPlaceholder"
        placeholder={t.contact.form.emailPlaceholder}
      />
    </div>

    <!-- Message -->
    <div>
      <label
        for="message"
        class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
        data-i18n="contact.form.message"
      >
        {t.contact.form.message}
      </label>
      <textarea
        id="message"
        name="message"
        required
        rows="6"
        class="w-full px-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white placeholder-slate-400 dark:placeholder-slate-500 focus:ring-2 focus:ring-teal-900 dark:focus:ring-teal-600 focus:border-transparent transition-all resize-none"
        data-i18n-placeholder="contact.form.messagePlaceholder"
        placeholder={t.contact.form.messagePlaceholder}></textarea>
    </div>

    <!-- Submit Button -->
    <div>
      <button
        type="submit"
        class="w-full px-6 py-4 bg-teal-900 dark:bg-teal-600 text-white rounded-lg hover:bg-teal-800 dark:hover:bg-teal-500 transition-all hover:scale-105 hover:shadow-lg font-bold text-lg focus:outline-none focus:ring-2 focus:ring-teal-900 dark:focus:ring-teal-600 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
        data-i18n="contact.form.send"
      >
        {t.contact.form.send}
      </button>
    </div>

    <!-- Status Messages -->
    <div id="form-status" class="hidden">
      <p
        id="success-message"
        class="hidden p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 text-green-800 dark:text-green-300 rounded-lg"
        data-i18n="contact.form.success"
      >
        {t.contact.form.success}
      </p>
      <p
        id="error-message"
        class="hidden p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-800 dark:text-red-300 rounded-lg"
        data-i18n="contact.form.error"
      >
        {t.contact.form.error}
      </p>
    </div>
  </form>
</div>

<script>
  const form = document.getElementById("contact-form") as HTMLFormElement;
  const submitButton = form?.querySelector(
    'button[type="submit"]',
  ) as HTMLButtonElement;
  const successMessage = document.getElementById(
    "success-message",
  ) as HTMLElement;
  const errorMessage = document.getElementById("error-message") as HTMLElement;
  const formStatus = document.getElementById("form-status") as HTMLElement;

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();

    if (!form || !submitButton) return;

    // Guardar texto original del botón
    const originalText = submitButton.textContent;
    const currentLang = localStorage.getItem("language") || "en";
    const sendingText = currentLang === "es" ? "Enviando..." : "Sending...";

    // Deshabilitar botón y mostrar estado de envío
    submitButton.disabled = true;
    submitButton.textContent = sendingText;

    // Ocultar mensajes previos
    successMessage.classList.add("hidden");
    errorMessage.classList.add("hidden");
    formStatus.classList.remove("hidden");

    try {
      const formData = new FormData(form);

      const response = await fetch("https://api.web3forms.com/submit", {
        method: "POST",
        body: formData,
      });

      const data = await response.json();

      if (data.success) {
        // Mostrar mensaje de éxito
        successMessage.classList.remove("hidden");
        form.reset();
      } else {
        throw new Error(data.message || "Error al enviar el formulario");
      }
    } catch (error) {
      console.error("Error sending form:", error);
      // Mostrar mensaje de error
      errorMessage.classList.remove("hidden");
    } finally {
      // Restaurar botón
      submitButton.disabled = false;
      submitButton.textContent = originalText;
    }
  });
</script>
